# Contributing

This page explains how to contribute code to openoakland.org. **By contributing to this project, you agree to adhere to OpenOakland’s [Code of Conduct](https://openoakland.org/code-of-conduct).**

## Page content

- [Installation instructions](#installation-instructions)
- [Working with issues](#working-with-issues)
- [Working with forks and branches](#working-with-forks-and-branches)
- [Working with pull requests and reviews](#working-with-pull-requests-and-reviews)
- [Updating page content](#updating-page-content)
- [Adding or updating projects](#adding-or-updating-projects)
- [Testing](#testing)
- [Deployment](#deployment)

## Installation instructions

### Prerequisites:

- [GNU Make](https://www.gnu.org/software/make/)
- [Ruby 2.5+](https://www.ruby-lang.org/en/)
- [bundler](https://bundler.io/)

### Setup (Local)

Clone or fork the repository and navigate to the project folder.

Install project dependencies.

    $ make setup

Build the site.

    $ make build

Run some checks.

    $ make test

Start a local server.

    $ make serve

Open your web browser to [localhost:4000](http://localhost:4000/).

### Setup (Docker)

With [Docker](https://www.docker.com/) installed, navigate to the project folder and run:

    $ make docker_serve

Open your web browser to [localhost:4000](http://localhost:4000/).

## Working with issues

- How to submit a bug:
  - Create an issue, follow the template, and make sure you add a `bug` tag to it.
- How to submit a feature request:
  - Create an issue outlining the request, follow the template, and make sure you add a `request` tag to it.
- How to contribute to an existing issue:
  - Request Write privileges from an admin or any of OpenOakland's elected officers.
  - Visit the [Ongoing Improvements Backlog]{https://github.com/openoakland/openoakland.org/projects/2} project to view issues that are ready to work on.
  - Assign an issue to yourself.
  - Once assigned, the project will move to the `In Progress` column in our [project board](https://github.com/openoakland/openoakland.org/projects).

## Working with forks and branches

- Once you’ve gotten the code set up and running, and assigned an issue to yourself, make sure you make a branch off of `main`. Please follow the guidelines for naming branches:
  - If you are working on a feature issue, name the branch `feat/{ISSUE-NAME}`
  - If you are working on a bug issue, name the branch `bug/{ISSUE-NAME}`
  - If you are working on a content update, name the branch `update/{ISSUE-NAME}`

## Working with pull requests and reviews

- Follow the pull request template. If there are design changes, please include screenshots.
- Add the [website-admins](https://github.com/orgs/openoakland/teams/website-admins) team as a reviewer on the pull request.
- Add anyone else who may have relevant knowledge, or anyone you worked or spoke with, if applicable.
- Make sure the CircleCI builds and tests pass. If they don’t, go ahead and continue to work and push up additional commits. The build must be successful before your work is merged.
  - To build your code locally before pushing up your commits, run the following command in your terminal: `circleci local execute --job build`.
- Wait for feedback, or for your branch to be merged!
- We typically delete branches after the code has been merged to `main`, so feel free to make a new branch for each new issue you work on.

## Updating page content
Content should be updated via the markdown files in the `src` folder, which may be more approachable for those new to code (see [Mastering Markdown](https://guides.github.com/features/mastering-markdown/) for guidance). More complex content is generated by adding html includes to the markdown files (e.g. `{% include steering-committee.html %}` within the `about-us.md` file). See the `src` > `_includes` folder.


## Adding or updating projects
Projects that appear on openoakland.org/projects are listed at the following file paths, based on project status:
- `src/_data/active_projects.yml`
- `src/_data/incubating_projects.yml`
- `src/_data/idle_projects.yml`
- `src/_data/delivered_projects.yml`
- `src/_data/decommissioned_projects.yml`

To update project details, such as description or project lead, find the project in its appropriate .yml file and replace the specific text using markdown syntax. 

To change a project's status (so it filters properly on openoakland.org/projects), delete the project from its old file and add it to the .yml file that corresponds to its current status.

To add a new project, copy and paste a new project block into the appropriate .yml file:

```yaml
-
  name:
  description:
  image:
  website: 
  repo:
  tech:
  leader:
  slack_id:
  slack_channel:
  established:
  closed:
 ```

Some syntax rules to be aware of:
- Project block must be separated from the previous project block with a `-` character.
- Each metadata tag should be indented with two spaces.
- There can be no trailing spaces at the end of each line.
- There can be no trailing characters or spaces at the very end of the file, including the `-` character that separates projects (those should only appear _above_ each project section).
- The frontend will not display html included in a project's description. Theoretically, you should be able to escape html characters by placing the description within double-quotes but this needs validation.

The following metadata tags are used to populate the project cards and should be left blank if no details exist:
- `name:` Project name
- `description:` Short (2-3 sentence) description that describes the project's goal and how it achieves it.
- `image:` Thumbnail filename (recommended min. 300px wide and uploaded to `src/assets/images/projects/projectname.png`)
- `website:` Public-facing URL of live project
- `repo:` URL of primary code repository (if more than one, the primary repo should clearly link to related repos in the ReadMe)
- `tech:` Platforms and languages used (enter "TBD" if not decided yet)
- `leader:` Name of Project Lead (preferably their Slack handle)
- `slack_id:` See "How to find the `slack_id` of a Slack channel" section below
- `slack_channel:` Name of Slack channel
- `established:` Year the project was approved (does not currently appear in project card on frontend)
- `closed:` Year the project was delivered or decommissioned (does not currently appear in project card on frontend)



### Editing the project file directly in Github 

If you don't want to install the repo locally, you can follow these instructions to edit projects directly in GitHub:

1. Go to the [src > data](https://github.com/openoakland/openoakland.org/tree/main/src/_data) folder located in the repo's main `Code` tab.
2. Click on the appropriate `{status}_projects.yml` file to open it. 
3. In the top-right corner of the file view area, click the pencil icon to open the editor. 
4. Make your edits according to the instructions above under "Adding or updating projects."
5. When ready for review, scroll to "Commit changes" at the bottom of the editor.
6. Enter a brief description of your changes.
7. Select "Create a new branch for this commit and start a pull request." Github will generate a branch name for you, or you can specify one. 
8. Click the "Propose file changes" button.
9. You will be taken to a page titled "Open a pull request." The message you entered on the previous page will be populated here. If your changes are to project content only, you can ignore or delete all the pull request template stuff below your message.
10. To make sure your pull request gets prompt attention, select 1-2 of OpenOakland's elected officers from the "Reviewers" section of the righthand sidebar (2021 admins: [theecrit](https://github.com/theecrit) and [seamarOO](https://github.com/seamarOO)).
11. Click the green "Create pull request" button and you're all done! Someone will review your pull request and either offer feedback or accept your changes. 
12. Give yourself a high five for helping to ensure OpenOakland's site is up to date. We appreciate you!


#### How to find the `slack_id` of a Slack channel:

1. Visit [openoakland.slack.com](openoakland.slack.com) in your browser
2. Click on the channel you want to find the ID for, for example, [#oo-website](https://app.slack.com/client/T02FEGG84/CH1U5KJ48)
3. The channel's ID is the last part of the URL, following the last `/`. For #oo-website, it's `CH1U5KJ48`

## Testing

- Run `make test` in your terminal (or `make docker_test`) before making a pull request.

## Deployment

This site is deployed automatically from the `main` branch. [CircleCI](https://circleci.com) watches for changes, verifies the site looks good, and then pushes the site to an AWS S3 bucket using an IAM account.

The [infra](https://github.com/openoakland/infra) repo creates the S3 bucket, DNS record, Cloud Front distribution, and IAM user to make it all work. Once created, the IAM credentials are generated from infra and must be added to
[CircleCI](https://circleci.com/gh/openoakland/openoakland.org/edit#env-vars) for CircleCI to write to the S3 bucket:

- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCES_KEY`
